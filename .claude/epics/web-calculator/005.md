---
name: 键盘支持
status: open
created: 2025-10-20T13:41:04Z
updated: 2025-10-20T13:41:04Z
github: [Will be updated when synced to GitHub]
depends_on: [004]
parallel: true
conflicts_with: [004]
---

# Task: 键盘支持

## Description

为计算器添加完整的键盘输入支持,允许用户通过键盘进行所有操作。实现键盘事件监听和映射,确保键盘输入与鼠标点击效果一致,提升用户体验和操作效率。

## Acceptance Criteria

- [ ] 支持数字键 0-9 输入
- [ ] 支持运算符键 +、-、*、/ 输入
- [ ] 支持 Enter 或 = 键触发计算
- [ ] 支持 Backspace 键退格
- [ ] 支持 Escape 或 c/C 键清除
- [ ] 支持小数点 . 键输入
- [ ] 使用 `preventDefault()` 阻止默认行为 (如表单提交)
- [ ] 键盘输入与按钮点击效果完全一致

## Technical Details

**键盘事件监听代码** (添加到 Task 004 的 JavaScript 代码之后):

```javascript
// 键盘事件映射表
const keyMap = {
  '0': () => inputDigit('0'),
  '1': () => inputDigit('1'),
  '2': () => inputDigit('2'),
  '3': () => inputDigit('3'),
  '4': () => inputDigit('4'),
  '5': () => inputDigit('5'),
  '6': () => inputDigit('6'),
  '7': () => inputDigit('7'),
  '8': () => inputDigit('8'),
  '9': () => inputDigit('9'),
  '.': () => inputDecimal(),
  '+': () => setOperator('+'),
  '-': () => setOperator('-'),
  '*': () => setOperator('×'),
  '/': () => setOperator('÷'),
  'Enter': () => calculate(),
  '=': () => calculate(),
  'Backspace': () => deleteLastDigit(),
  'Delete': () => deleteLastDigit(),
  'Escape': () => resetCalculator(),
  'c': () => resetCalculator(),
  'C': () => resetCalculator()
};

// 键盘事件监听器
document.addEventListener('keydown', (event) => {
  const action = keyMap[event.key];

  if (action) {
    event.preventDefault(); // 阻止默认行为
    action();

    // 可选: 添加视觉反馈 (高亮对应按钮)
    highlightButton(event.key);
  }
});

// 可选: 按钮高亮反馈函数
function highlightButton(key) {
  let selector;

  if (/^[0-9]$/.test(key)) {
    selector = `[data-number="${key}"]`;
  } else if (key === '.') {
    selector = '[data-action="decimal"]';
  } else if (['+', '-', '×', '÷'].includes(key)) {
    const operator = key === '*' ? '×' : key === '/' ? '÷' : key;
    selector = `[data-operator="${operator}"]`;
  } else if (key === 'Enter' || key === '=') {
    selector = '[data-action="equals"]';
  } else if (key === 'Backspace' || key === 'Delete') {
    selector = '[data-action="delete"]';
  } else if (key === 'Escape' || key.toLowerCase() === 'c') {
    selector = '[data-action="clear"]';
  }

  if (selector) {
    const button = document.querySelector(selector);
    if (button) {
      button.classList.add('active');
      setTimeout(() => button.classList.remove('active'), 100);
    }
  }
}
```

**CSS 增强** (可选,添加键盘触发的视觉反馈):
```css
button.active {
  transform: scale(0.95);
  background: #cbd5e0 !important;
}
```

**键盘映射说明**:
- **数字**: 0-9 → inputDigit()
- **运算符**: +, -, *, / → setOperator() (注意 * 映射到 ×, / 映射到 ÷)
- **等号**: Enter, = → calculate()
- **退格**: Backspace, Delete → deleteLastDigit()
- **清除**: Escape, c, C → resetCalculator()
- **小数点**: . → inputDecimal()

## Dependencies

- [ ] Task 004: 核心 JavaScript 逻辑完成 (需要调用已有函数)

## Effort Estimate

- **Size**: S
- **Hours**: 1-2 小时
- **Parallel**: true (可与错误处理任务并行,但建议在 Task 004 完成后进行)

## Definition of Done

- [ ] 键盘事件监听代码已添加到 index.html
- [ ] 所有键盘快捷键正常工作
- [ ] 键盘输入效果与鼠标点击一致
- [ ] 特殊键 (Enter, Escape, Backspace) 正常工作
- [ ] `preventDefault()` 成功阻止了不必要的默认行为
- [ ] 通过键盘完成测试用例:
  - [ ] 键盘输入 `1 2 3 + 4 5 6 Enter` → 显示 579
  - [ ] 键盘输入 `1 0 / 0 Enter` → 错误提示
  - [ ] 按 Escape 键 → 显示清空为 0
- [ ] 代码已提交到 Git
